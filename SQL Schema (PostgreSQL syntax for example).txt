-- Drop tables in dependency order
DROP TABLE IF EXISTS ServiceTarget;
DROP TABLE IF EXISTS ServiceOffering;
DROP TABLE IF EXISTS Location;
DROP TABLE IF EXISTS Organization;
DROP TABLE IF EXISTS OrganizationType;
DROP TABLE IF EXISTS ServiceCategory;
DROP TABLE IF EXISTS TargetGroup;

-- 1. OrganizationType Table
CREATE TABLE OrganizationType (
    TypeID SERIAL PRIMARY KEY,
    TypeName VARCHAR(50) NOT NULL UNIQUE
);

-- 2. ServiceCategory Table
CREATE TABLE ServiceCategory (
    CategoryID SERIAL PRIMARY KEY,
    CategoryName VARCHAR(100) NOT NULL UNIQUE
);

-- 6. TargetGroup Table
CREATE TABLE TargetGroup (
    TargetGroupID SERIAL PRIMARY KEY,
    GroupName VARCHAR(100) NOT NULL UNIQUE
);

-- 3. Organization Table
CREATE TABLE Organization (
    OrgID SERIAL PRIMARY KEY,
    OrgName VARCHAR(255) NOT NULL,
    Description TEXT,
    Website VARCHAR(255),
    ContactPhone VARCHAR(50),
    ContactEmail VARCHAR(255),
    TypeID INT NOT NULL,
    FOREIGN KEY (TypeID) REFERENCES OrganizationType(TypeID)
);

-- 4. Location Table
CREATE TABLE Location (
    LocationID SERIAL PRIMARY KEY,
    OrgID INT, -- Nullable if location is a general service area not tied to one office
    Country VARCHAR(100) NOT NULL,
    StateProvince VARCHAR(100),
    City VARCHAR(100),
    ZipCode VARCHAR(20),
    IsServiceArea BOOLEAN DEFAULT TRUE, -- True if this row describes a service area, false if it's an office address
    FOREIGN KEY (OrgID) REFERENCES Organization(OrgID)
);

-- 5. ServiceOffering Table
CREATE TABLE ServiceOffering (
    ServiceOfferingID SERIAL PRIMARY KEY,
    OrgID INT NOT NULL,
    CategoryID INT NOT NULL,
    ServiceDetails TEXT NOT NULL,
    EligibilityCriteria TEXT,
    IsFree BOOLEAN NOT NULL DEFAULT TRUE, -- True for free, false for low-cost/subsidized
    Notes TEXT,
    FOREIGN KEY (OrgID) REFERENCES Organization(OrgID),
    FOREIGN KEY (CategoryID) REFERENCES ServiceCategory(CategoryID)
);

-- 7. ServiceTarget Table (Junction table for ServiceOffering and TargetGroup)
CREATE TABLE ServiceTarget (
    ServiceOfferingID INT NOT NULL,
    TargetGroupID INT NOT NULL,
    PRIMARY KEY (ServiceOfferingID, TargetGroupID),
    FOREIGN KEY (ServiceOfferingID) REFERENCES ServiceOffering(ServiceOfferingID) ON DELETE CASCADE,
    FOREIGN KEY (TargetGroupID) REFERENCES TargetGroup(TargetGroupID) ON DELETE CASCADE
);